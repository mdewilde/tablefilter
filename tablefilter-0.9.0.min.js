/*
 * tablefilter.js
 * Version: 0.9.0
 *
 * (c) 2016 Marceau Dewilde
 * Licensed under Apache License v2.0
 * http://www.apache.org/licenses/LICENSE-2.0
 */
var tablefilter=function(){var t=function(e){return this.presets=t.getPresets(e),this.presets?(this.node=e,this.method=t.parseMethod(this),this.method?(this.extractor=t.parseExtractor(this),this.extractor?(e.hasAttribute("data-tablefilter-id")||e.setAttribute("data-tablefilter-id","_"+t.counter++ +"_"),this.id=e.getAttribute("data-tablefilter-id"),this.node.tablefilter=this,void(this.valid=!0)):!1):!1):!1};return t.prototype.attach=function(){for(var t=0;t<this.presets.triggers.length;t++)this.node.addEventListener(this.presets.triggers[t],this.countdown)},t.prototype.detach=function(){for(var t=0;t<this.presets.triggers.length;t++)this.node.removeEventListener(this.presets.triggers[t],this.countdown)},t.parseMethod=function(t){return t.node.hasAttribute("data-tablefilter-contain")?t.methods.contain:t.node.hasAttribute("data-tablefilter-exact")?t.methods.exact:t.node.hasAttribute("data-tablefilter-exclude")?t.methods.exclude:t.node.hasAttribute("data-tablefilter-min")?t.methods.min:t.node.hasAttribute("data-tablefilter-max")?t.methods.max:t.methods.contain},t.prototype.methods={contain:function(t,e){this.extractor(t).search(e.regEx)>-1?this.show(t):this.hide(t)},exact:function(t,e){this.extractor(t)===e.raw?this.show(t):this.hide(t)},exclude:function(t,e){this.extractor(t).search(e.regEx)>-1?this.hide(t):this.show(t)},min:function(t,e){var r=this.extractor(t);return r&&r.length&&(r=r.toLowerCase(),r>=e.lowercase)?void this.show(t):void this.hide(t)},max:function(t,e){var r=this.extractor(t);return r&&r.length&&(r=r.toLowerCase(),r<=e.lowercase)?void this.show(t):void this.hide(t)}},t.prototype.prepareValue=function(){return this.node.value?{raw:this.node.value,regEx:new RegExp(this.node.value,"i"),lowercase:this.node.value.toLowerCase()}:!1},t.prototype.filter=function(){var t=this.prepareValue();if(!t)return!1;for(var e=document.getElementsByTagName("table"),r=0;r<e.length;r++)if(e[r].hasAttribute("data-tablefiltered"))for(var i=e[r].getElementsByTagName("tr"),a=0;a<i.length;a++)i[a].getElementsByTagName("td").length>0&&this.method(i[a],t)},t.parseExtractor=function(t){return t.clazz=t.node.getAttribute("data-tablefilter-onclass"),t.attr=t.node.getAttribute("data-tablefilter-byattribute"),t.clazz?t.attr?t.extractors.attrInClass:t.extractors.textInClass:t.attr?t.extractors.attr:t.extractors.text},t.prototype.extractors={text:function(t){return t.textContent},textInClass:function(e){if(t.hasClass(e))return e.textContent;for(var r="",i=e.getElementsByClassName(this.clazz),a=0;a<i.length;a++)r+=i[a].textContent;return r},attr:function(t){var e=[].slice.call(t.getElementsByTagName("*"));e.push(t);for(var r="",i=0;i<e.length;i++){var a=e[i].getAttribute(this.attr);a&&(r+=a)}return r},attrInClass:function(t){for(var e=t.getAttribute(this.attr)||"",r=[].slice.call(t.getElementsByClassName(this.clazz)),i=0;i<r.length;i++){var a=r[i].getAttribute(this.attr);a&&(e+=a)}return e}},t.prototype.show=function(t){var e=t.getAttribute("data-tablefilter-ids");e&&(e=e.replace(this.id,""),t.setAttribute("data-tablefilter-ids",e),e.length||(t.style.display="table-row"))},t.prototype.hide=function(t){var e=t.getAttribute("data-tablefilter-ids");e?-1===e.indexOf(this.id)&&(e+=this.id):e=this.id,t.setAttribute("data-tablefilter-ids",e),e.length&&(t.style.display="none")},t.prototype.isUndo=function(){return"checkbox"===this.presets.type?!this.node.checked:!this.node.value},t.prototype.undo=function(){for(var t=document.getElementsByTagName("tr"),e=0;e<t.length;e++)this.show(t[e])},t.prototype.countdown=function(){this.tablefilter.filterTimeout&&clearTimeout(this.tablefilter.filterTimeout),this.tablefilter.filterTimeout=setTimeout(function(){this.tablefilter.run()}.bind(this),this.tablefilter.presets.timeout)},t.prototype.run=function(){console.time("run"),this.isUndo()?this.undo():this.filter(),t.callback(),console.timeEnd("run")},t.counter=0,t.callback=function(){},t.destroy=function(){for(var e=document.querySelectorAll("[data-tablefilter-ids]"),r=0;r<e.length;++r)e[r].removeAttribute("data-tablefilter-ids"),e[r].style.display="table-row";for(var i=document.querySelectorAll("[data-tablefilter]"),a=0;a<i.length;++a){var o=i[a].tablefilter;o&&o instanceof t&&o.detach(),i[a].tablefilter=void 0}t.counter=0},t.strip=function(t){"object"==typeof t&&"removeAttribute"in t&&(t.removeAttribute("data-tablefilter"),t.removeAttribute("data-tablefilter-id"),t.removeAttribute("data-tablefilter-contain"),t.removeAttribute("data-tablefilter-exact"),t.removeAttribute("data-tablefilter-exclude"),t.removeAttribute("data-tablefilter-min"),t.removeAttribute("data-tablefilter-max"),t.removeAttribute("data-tablefilter-onclass"),t.removeAttribute("data-tablefilter-byattribute"))},t.hasClass=function(t,e){return(" "+t.className+" ").indexOf(" "+e+" ")>-1},t.getPresets=function(t){var e=t.tagName.toLowerCase();if("select"===e)return{type:"select",timeout:50,triggers:["change","keyup"]};if("textarea"===e)return{type:"input",timeout:500,triggers:["keyup"]};if("input"===e){var r=t.getAttribute("type");return"string"==typeof r&&(r=r.trim().toLowerCase()),"button"===r||"submit"===r?!1:"color"===r||"file"===r||"hidden"===r||"image"===r?!1:"radio"===r||"range"===r?!1:"checkbox"===r?t.value&&t.value.length?{type:"checkbox",timeout:50,triggers:["change"]}:!1:{type:"input",timeout:500,triggers:["keyup"]}}return!1},t.init=function(e){t.destroy(),"function"==typeof e&&(t.callback=e);for(var r=document.querySelectorAll("[data-tablefilter]"),i=0;i<r.length;++i){var a=new t(r[i]);a.valid?(a.attach(),a.run()):t.strip(r[i])}},t.init}();